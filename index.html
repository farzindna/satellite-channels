<!doctype html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ریموت کانال‌ها • لیست ساده و قابل‌ویرایش</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;600;700;900&display=swap">
<style>
  :root{
    --bg:#0f172a;      /* آبی خیلی تیره */
    --panel:#111827;   /* خاکستری تیره */
    --row:#0b1220;     /* پس‌زمینه هر ردیف */
    --text:#e5e7eb;    /* متن روشن */
    --muted:#94a3b8;   /* متن کم‌رنگ */
    --brand:#60a5fa;   /* آبی دکمه‌ها */
    --accent:#22d3ee;  /* آبی-سبز دسته فعال */
    --border:#1e293b;  /* خط جداکننده */
    --danger:#f87171;  /* قرمز حذف */
    --edit:#60a5fa;    /* آبی ویرایش */
    --star:#ffd166;    /* زرد ستاره */
    --font:"Vazirmatn","IRANSans","Segoe UI","Tahoma",sans-serif;
  }
  *{box-sizing:border-box}
  body{
    margin:0;background:linear-gradient(180deg,var(--bg),#0b1022);
    color:var(--text);font-family:var(--font);
  }
  header{
    position:sticky;top:0;z-index:10;background:rgba(17,24,39,.85);
    backdrop-filter:blur(10px);border-bottom:1px solid var(--border);
  }
  .wrap{max-width:880px;margin:0 auto;padding:14px}
  .title{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .title h1{margin:0;font-size:20px}
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  input[type="search"]{
    flex:1;min-width:220px;background:#0b1220;border:1px solid var(--border);color:var(--text);
    padding:10px;border-radius:12px;outline:none;font-size:14px;
  }
  .btn{background:var(--brand);color:#081325;border:0;border-radius:12px;padding:10px 14px;cursor:pointer;font-weight:700}
  .btn.ghost{background:#0b1220;color:var(--muted);border:1px solid var(--border);font-weight:600}
  .btn.warn{background:#f59e0b;color:#0b0f1a}
  .cats{display:flex;gap:6px;flex-wrap:wrap;margin-top:8px}
  .cat{padding:6px 12px;background:#0b1220;border:1px solid var(--border);border-radius:999px;color:var(--muted);cursor:pointer;font-size:13px}
  .cat.active{background:var(--accent);color:#062027;border-color:transparent;font-weight:800}
  main{padding:10px 0}

  /* لیست عمودی */
  .list{background:transparent;border:1px solid var(--border);border-radius:14px;overflow:hidden}
  .item{
    display:flex;align-items:center;gap:12px;
    padding:10px 12px;background:var(--row);
    border-bottom:1px dashed var(--border);
  }
  .item:last-child{border-bottom:none}
  .item:hover{background:var(--panel)}
  .num{
    width:32px;height:32px;border-radius:50%;background:var(--brand);color:#061122;
    display:flex;align-items:center;justify-content:center;font-weight:900;flex:0 0 32px
  }
  .item.dragging{opacity:.5}
  .item.drop-before{box-shadow:0 -3px 0 0 var(--accent)}
  .item.drop-after{box-shadow:0 3px 0 0 var(--accent)}
  /* بخش کلیک‌پذیر برای بازکردن لینک */
  .info{
    display:flex;flex-direction:column;gap:2px;min-width:0;cursor:pointer;
  }
  .name{font-weight:900;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-size:15px}
  .meta{color:var(--muted);font-size:12.5px}
  .actions{margin-right:auto;display:flex;align-items:center;gap:8px}
  .btn.small{padding:6px 10px;border-radius:9px;font-weight:800;font-size:13px}
  .btn.star{background:#0b1220;border:1px solid var(--border);color:var(--star)}
  .btn.edit{background:var(--edit);color:#081325}
  .btn.delete{background:var(--danger);color:#0b0f1a}
  .hint{opacity:.7;font-size:12px;padding:8px}
  footer{opacity:.7;font-size:12px;padding:10px 14px;border-top:1px solid var(--border)}

  dialog{
    border:1px solid #243244;border-radius:14px;background:#0d1426;color:var(--text);
    max-width:520px;width:calc(100% - 24px);padding:16px;
  }
  dialog form{display:grid;gap:10px}
  dialog input, dialog select{
    background:#0b1220;border:1px solid var(--border);color:var(--text);
    padding:10px;border-radius:10px;width:100%;font-size:14px
  }
  .form-row{display:grid;gap:10px;grid-template-columns:1fr 1fr}
  .small{font-size:12px;color:var(--muted)}

  /* Gate (simple password overlay) */
  #gate{position:fixed;inset:0;background:rgba(8,12,24,.96);display:none;align-items:center;justify-content:center;z-index:9999}
  #gate .panel{background:#0d1426;border:1px solid var(--border);border-radius:14px;padding:20px;width:min(380px,calc(100% - 24px));display:grid;gap:10px;color:var(--text)}
  #gate input{background:#0b1220;border:1px solid var(--border);color:var(--text);padding:10px;border-radius:10px;font-size:14px}
  #gate .err{color:#f87171;font-size:12px;min-height:16px}
  #gate .passwrap{position:relative;display:flex;align-items:center}
  #gate .passwrap input{width:100%;padding-inline-end:40px}
  #gate .passwrap .eye{position:absolute;right:8px;background:transparent;border:0;color:var(--muted);cursor:pointer;font-size:18px;line-height:1;padding:4px;border-radius:8px}
  #gate .passwrap .eye:hover{color:var(--text);background:#0b1220}
</style>
</head>
<body>
  <!-- Password Gate -->
  <div id="gate" aria-modal="true" role="dialog">
    <div class="panel">
      <h3 style="margin:0">ورود</h3>
      <div class="small">رمز عبور را وارد کن</div>
      <div class="passwrap">
        <input id="gatePass" type="password" />
        <button type="button" id="gateToggle" class="eye" aria-label="نمایش رمز">👁</button>
      </div>
      <div id="gateErr" class="err"></div>
      <button class="btn" id="gateBtn">ورود</button>
    </div>
  </div>
  <header>
    <div class="wrap">
      <div class="title">
        <h1>📃 لیست کانال‌ها</h1>
        <span class="small">ساده، راست‌چین، قابل‌ویرایش — فقط لینک‌های رسمی و قانونی</span>
      </div>
      <div class="controls">
        <input id="q" type="search" placeholder="جستجوی کانال…" />
        <button class="btn" id="addBtn">➕ افزودن کانال</button>
        <button class="btn ghost" id="exportBtn">⬇️ خروجی JSON</button>
        <button class="btn ghost" id="importBtn">⬆️ ورود JSON</button>
        <button class="btn warn" id="resetBtn" title="بازنشانی به پیش‌فرض‌ها">Reset</button>
      </div>
      <div class="cats" id="cats"></div>
    </div>
  </header>

  <main class="wrap">
    <div id="list" class="list"></div>
    <div id="empty" class="hint" style="display:none">چیزی پیدا نشد. از جستجو/دسته‌ها کمک بگیر یا «افزودن کانال» را بزن.</div>
  </main>

  <footer class="wrap">
    <div>نکته: برخی پخش‌ها ممکن است به‌دلیل محدودیت منطقه‌ای باز نشوند. فقط URLهای رسمی/مجاز را اضافه کن.</div>
  </footer>

  <!-- Dialog: Add/Edit -->
  <dialog id="dlg">
    <form id="form">
      <h3>افزودن/ویرایش کانال</h3>
      <div class="form-row">
        <input name="name" placeholder="نام کانال (مثلاً Manoto)" required />
        <select name="category" required>
          <option value="خبر">خبر</option>
          <option value="فیلم‌وسریال">فیلم‌وسریال</option>
          <option value="مستند">مستند</option>
          <option value="موسیقی">موسیقی</option>
          <option value="کودک">کودک</option>
          <option value="ورزشی">ورزشی</option>
          <option value="عمومی">عمومی</option>
        </select>
      </div>
      <input name="url" placeholder="لینک پخش رسمی (https://…)" required />
      <input name="logo" placeholder="لینک لوگو (اختیاری)" />
      <div class="small">صرفاً URL رسمی/قانونی را قرار بده.</div>
      <div style="display:flex;gap:8px;justify-content:flex-end">
        <button type="submit" class="btn">ذخیره</button>
        <button type="button" class="btn ghost" id="closeDlg">انصراف</button>
      </div>
    </form>
  </dialog>

<script>
/* ---------- محافظ ساده (رمز عبور سمت کاربر) ---------- */
const PASS = "farzin@mn"; // رمز دلخواه
function tryAuth(){
  const input = document.getElementById('gatePass');
  const err   = document.getElementById('gateErr');
  if(!input) return;
  if(input.value === PASS){
    sessionStorage.setItem('auth','1');
    document.getElementById('gate').style.display='none';
    renderCats(); renderList();
  }else{
    err.textContent = 'رمز اشتباه است.';
    input.focus();
  }
}
function setupGate(){
  const gate = document.getElementById('gate');
  const input= document.getElementById('gatePass');
  const btn  = document.getElementById('gateBtn');
  const tgl  = document.getElementById('gateToggle');
  const authed = sessionStorage.getItem('auth')==='1';
  if(authed){ gate.style.display='none'; return renderCats(), renderList(); }
  gate.style.display='flex';
  btn.onclick = tryAuth;
  input.addEventListener('keydown', (e)=>{ if(e.key==='Enter') tryAuth(); });
  if(tgl) tgl.onclick = togglePass;
}

function togglePass(){
  const input = document.getElementById('gatePass');
  const tgl = document.getElementById('gateToggle');
  if(!input || !tgl) return;
  if(input.type === 'password'){
    input.type = 'text';
    tgl.textContent = '🙈';
    tgl.setAttribute('aria-label','مخفی کردن رمز');
  } else {
    input.type = 'password';
    tgl.textContent = '👁';
    tgl.setAttribute('aria-label','نمایش رمز');
  }
  input.focus({ preventScroll: true });
}

/* ---------- داده‌های پیش‌فرض (فقط رسمی/قانونی) ---------- */
const DEFAULT_CHANNELS = [
  {name:"Iran International", category:"خبر", url:"https://www.youtube.com/watch?v=otooINZRTSQ", logo:""},
  {name:"فیلم های یوتیوب", category:"فیلم‌وسریال", url:"https://www.youtube.com/channel/UClgRkhTL3_hImCAmdLfDE4g", logo:""},
  {name:"لیسانسه ها", category:"فیلم‌وسریال", url:"https://telewebion.com/product/0xc20be8f", logo:""},
  {name:"من و تو", category:"فیلم‌وسریال", url:"https://www.youtube.com/watch?v=e8UIOWQqej4", logo:""},
  {name:"IFilm", category:"فیلم‌وسریال", url:"https://telewebion.com/live/ifilm", logo:""},
  {name:"نوا", category:"موسیقی", url:"https://telewebion.com/live/nava", logo:""},
  {name:"شبکه نمایش", category:"فیلم‌وسریال", url:"https://telewebion.com/live/namayesh", logo:""},
  {name:"مستند", category:"مستند", url:"https://telewebion.com/live/mostanad", logo:""},
  {name:"نسیم", category:"فیلم‌وسریال", url:"https://telewebion.com/live/nasim", logo:""},
  {name:"شمعدونی", category:"فیلم‌وسریال", url:"https://telewebion.com/product/0xc20c9b9", logo:""},
  {name:"ساختمان پزشکان", category:"فیلم‌وسریال", url:"https://telewebion.com/program/0x1b29476", logo:""},
  {name:"مگه تمام عمر چندتا بهاره", category:"فیلم‌وسریال", url:"https://www.filimo.com/m/sdp93", logo:""},
  {name:"فوق لیسانسه ها", category:"فیلم‌وسریال", url:"https://telewebion.com/program/0x1b2a5df", logo:""},
  {name:"ای فیلم ۲", category:"فیلم‌وسریال", url:"https://fa2.ifilmtv.ir/Home/Live", logo:""},
  {name:"BBC", category:"خبر", url:"https://www.parsatv.com/name=BBC-Persian#persian", logo:""},
  {name:"PMC", category:"موسیقی", url:"https://www.parsatv.com/name=PMC-Royale#persian", logo:""},
  {name:"4music", category:"موسیقی", url:"https://www.parsatv.com/name=4Music#persian", logo:""},
];

const KEY = "channels.v1.list";
const FAV_KEY = "channels.fav.v1";

/* ---------- ذخیره/بارگذاری ---------- */
function loadChannels(){
  const raw = localStorage.getItem(KEY);
  return raw ? JSON.parse(raw) : DEFAULT_CHANNELS.slice();
}
function saveChannels(list){ localStorage.setItem(KEY, JSON.stringify(list)); }
function loadFavs(){ const raw = localStorage.getItem(FAV_KEY); return raw ? new Set(JSON.parse(raw)) : new Set(); }
function saveFavs(set){ localStorage.setItem(FAV_KEY, JSON.stringify([...set])); }

/* ---------- حالت برنامه ---------- */
let channels = loadChannels();
let favorites = loadFavs();
let activeCat = "همه";
let draggedName = null;

/* ---------- المنت‌ها ---------- */
const catsEl   = document.getElementById("cats");
const listEl   = document.getElementById("list");
const emptyEl  = document.getElementById("empty");
const qEl      = document.getElementById("q");
const dlg      = document.getElementById("dlg");
const form     = document.getElementById("form");
const addBtn   = document.getElementById("addBtn");
const closeDlg = document.getElementById("closeDlg");
const exportBtn= document.getElementById("exportBtn");
const importBtn= document.getElementById("importBtn");
const resetBtn = document.getElementById("resetBtn");

/* ---------- دسته‌ها ---------- */
function categories(){
  const cats = new Set(["همه","⭐️ علاقه‌مندی‌ها"]);
  channels.forEach(c=>cats.add(c.category||"عمومی"));
  return [...cats];
}
function renderCats(){
  catsEl.innerHTML = "";
  categories().forEach(cat=>{
    const b = document.createElement("button");
    b.className = "cat" + (activeCat===cat ? " active" : "");
    b.textContent = cat;
    b.onclick = ()=>{ activeCat=cat; renderList(); renderCats(); };
    catsEl.appendChild(b);
  });
}

/* ---------- فیلتر ---------- */
function isMatch(ch){
  const q = (qEl.value||"").trim().toLowerCase();
  const inCat = (activeCat==="همه")
      || (activeCat==="⭐️ علاقه‌مندی‌ها" && favorites.has(ch.name))
      || (ch.category===activeCat);
  const inText = !q || ch.name.toLowerCase().includes(q) || (ch.category||"").toLowerCase().includes(q);
  return inCat && inText;
}

/* ---------- رندر لیست ---------- */
function renderList(){
  listEl.innerHTML = "";
  const data = channels.filter(isMatch);

  if(!data.length){ listEl.style.display="none"; emptyEl.style.display="block"; return; }
  listEl.style.display="block"; emptyEl.style.display="none";

  data.forEach((ch, index)=>{
    const row   = document.createElement("div");
    row.className = "item";

    const num   = document.createElement("div");
    num.className = "num";
    num.textContent = index + 1;

    const info  = document.createElement("div");
    info.className = "info";
    const name  = document.createElement("div"); name.className="name"; name.textContent = ch.name;
    const meta  = document.createElement("div"); meta.className="meta"; meta.textContent = ch.category || "عمومی";
    info.appendChild(name); info.appendChild(meta);

    const actions = document.createElement("div");
    actions.className = "actions";

    const clearDropClasses = ()=>{
      listEl.querySelectorAll(".drop-before, .drop-after").forEach(el=>{
        el.classList.remove("drop-before","drop-after");
      });
    };

    row.draggable = true;
    row.addEventListener("dragstart", e=>{
      draggedName = ch.name;
      e.dataTransfer.effectAllowed = "move";
      e.dataTransfer.setData("text/plain", ch.name);
      row.classList.add("dragging");
    });
    row.addEventListener("dragend", ()=>{
      draggedName = null;
      row.classList.remove("dragging");
      clearDropClasses();
    });
    row.addEventListener("dragover", e=>{
      if(!draggedName || draggedName===ch.name) return;
      e.preventDefault();
      clearDropClasses();
      const rect = row.getBoundingClientRect();
      const after = e.clientY > rect.top + rect.height/2;
      row.classList.add(after ? "drop-after" : "drop-before");
      e.dataTransfer.dropEffect = "move";
    });
    row.addEventListener("dragleave", ()=>{
      row.classList.remove("drop-before","drop-after");
    });
    row.addEventListener("drop", e=>{
      e.preventDefault();
      clearDropClasses();
      const dragKey = draggedName || e.dataTransfer.getData("text/plain");
      if(!dragKey || dragKey===ch.name) return;
      const fromIndex = channels.findIndex(c=>c.name===dragKey);
      const baseIndex = channels.findIndex(c=>c.name===ch.name);
      if(fromIndex<0 || baseIndex<0) return;
      const rect = row.getBoundingClientRect();
      const after = e.clientY > rect.top + rect.height/2;
      let toIndex = baseIndex + (after ? 1 : 0);
      if(fromIndex < toIndex) toIndex -= 1;
      if(fromIndex === toIndex) return;
      const [moved] = channels.splice(fromIndex,1);
      channels.splice(toIndex,0,moved);
      saveChannels(channels);
      renderList();
    });

    // ★ علاقه‌مندی
    const btnFav = document.createElement("button");
    btnFav.className = "btn small star";
    btnFav.textContent = favorites.has(ch.name) ? "★" : "☆";
    btnFav.title = "افزودن به علاقه‌مندی‌ها";
    btnFav.onclick = (e)=>{
      e.preventDefault(); e.stopPropagation();
      if(favorites.has(ch.name)) favorites.delete(ch.name); else favorites.add(ch.name);
      saveFavs(favorites); renderList();
    };

    // ویرایش
    const btnEdit = document.createElement("button");
    btnEdit.className = "btn small edit";
    btnEdit.textContent = "ویرایش";
    btnEdit.onclick = (e)=>{
      e.preventDefault(); e.stopPropagation();
      editChannel(ch);
    };

    // حذف
    const btnDelete = document.createElement("button");
    btnDelete.className = "btn small delete";
    btnDelete.textContent = "حذف";
    btnDelete.onclick = (e)=>{
      e.preventDefault(); e.stopPropagation();
      if(confirm(`آیا از حذف کانال «${ch.name}» مطمئنید؟`)){
        channels = channels.filter(c => c.name !== ch.name);
        saveChannels(channels); renderList();
      }
    };

    actions.appendChild(btnFav);
    actions.appendChild(btnEdit);
    actions.appendChild(btnDelete);

    // فقط روی info لینک باز شود (نه کل ردیف)
    info.style.cursor = "pointer";
    info.onclick = (e)=>{
      e.stopPropagation();
      window.open(ch.url, "_blank", "noopener");
    };

    // دوبار کلیک روی ردیف = ویرایش
    row.ondblclick = ()=>{
      editChannel(ch);
    };

    row.appendChild(num);
    row.appendChild(info);
    row.appendChild(actions);
    listEl.appendChild(row);
  });
}

/* ---------- افزودن/ویرایش ---------- */
function openDialog(initial){
  dlg.showModal();
  form.reset();
  if(initial){
    form.name.value = initial.name || "";
    form.category.value = initial.category || "عمومی";
    form.url.value = initial.url || "";
    form.logo.value = initial.logo || "";
    dlg.dataset.edit = initial.name;
  }else{
    delete dlg.dataset.edit;
  }
}
function editChannel(ch){ openDialog(ch); }
function upsertChannel(data, oldName){
  const i = channels.findIndex(c=>c.name===oldName);
  if(i>=0) channels[i] = data; else channels.push(data);
  saveChannels(channels); renderCats(); renderList();
}

/* ---------- رویدادها ---------- */
qEl.addEventListener("input", renderList);
addBtn.onclick    = ()=>openDialog();
closeDlg.onclick  = ()=>dlg.close();

form.onsubmit = (e)=>{
  e.preventDefault();
  const data = {
    name: form.name.value.trim(),
    category: form.category.value,
    url: form.url.value.trim(),
    logo: form.logo.value.trim()
  };
  if(!/^https?:\/\//i.test(data.url)){
    alert("لطفاً لینک معتبر با http/https وارد کن.");
    return;
  }
  upsertChannel(data, dlg.dataset.edit);
  dlg.close();
};

exportBtn.onclick = ()=>{
  const blob = new Blob(
    [JSON.stringify({channels, favorites:[...favorites]}, null, 2)],
    {type:"application/json"}
  );
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "channels-export.json";
  a.click();
};

importBtn.onclick = ()=>{
  const inp = document.createElement("input");
  inp.type="file"; inp.accept="application/json";
  inp.onchange = ()=>{
    const f = inp.files[0]; if(!f) return;
    const r = new FileReader();
    r.onload = ()=>{
      try{
        const obj = JSON.parse(r.result);
        if(Array.isArray(obj.channels)){ channels = obj.channels; saveChannels(channels); }
        if(Array.isArray(obj.favorites)){ favorites = new Set(obj.favorites); saveFavs(favorites); }
        renderCats(); renderList();
      }catch(err){ alert("فایل نامعتبر است."); }
    };
    r.readAsText(f);
  };
  inp.click();
};

resetBtn.onclick = ()=>{
  if(confirm("بازنشانی به تنظیمات اولیه؟")){
    channels  = DEFAULT_CHANNELS.slice(); saveChannels(channels);
    favorites = new Set();               saveFavs(favorites);
    activeCat = "همه"; qEl.value="";
    renderCats(); renderList();
  }
};

/* ---------- شروع ---------- */
// ابتدا گیت ساده را فعال کن
setupGate();
</script>
</body>
</html>
