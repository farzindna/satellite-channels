<!doctype html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ø±ÛŒÙ…ÙˆØª Ú©Ø§Ù†Ø§Ù„â€ŒÙ‡Ø§ â€¢ Ù„ÛŒØ³Øª Ø³Ø§Ø¯Ù‡ Ùˆ Ù‚Ø§Ø¨Ù„â€ŒÙˆÛŒØ±Ø§ÛŒØ´</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;600;700;900&display=swap">
<style>
  :root{
    --bg:#0f172a;      /* Ø¢Ø¨ÛŒ Ø®ÛŒÙ„ÛŒ ØªÛŒØ±Ù‡ */
    --panel:#111827;   /* Ø®Ø§Ú©Ø³ØªØ±ÛŒ ØªÛŒØ±Ù‡ */
    --row:#0b1220;     /* Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ù‡Ø± Ø±Ø¯ÛŒÙ */
    --text:#e5e7eb;    /* Ù…ØªÙ† Ø±ÙˆØ´Ù† */
    --muted:#94a3b8;   /* Ù…ØªÙ† Ú©Ù…â€ŒØ±Ù†Ú¯ */
    --brand:#60a5fa;   /* Ø¢Ø¨ÛŒ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ */
    --accent:#22d3ee;  /* Ø¢Ø¨ÛŒ-Ø³Ø¨Ø² Ø¯Ø³ØªÙ‡ ÙØ¹Ø§Ù„ */
    --border:#1e293b;  /* Ø®Ø· Ø¬Ø¯Ø§Ú©Ù†Ù†Ø¯Ù‡ */
    --danger:#f87171;  /* Ù‚Ø±Ù…Ø² Ø­Ø°Ù */
    --edit:#60a5fa;    /* Ø¢Ø¨ÛŒ ÙˆÛŒØ±Ø§ÛŒØ´ */
    --star:#ffd166;    /* Ø²Ø±Ø¯ Ø³ØªØ§Ø±Ù‡ */
    --font:"Vazirmatn","IRANSans","Segoe UI","Tahoma",sans-serif;
  }
  *{box-sizing:border-box}
  body{
    margin:0;background:linear-gradient(180deg,var(--bg),#0b1022);
    color:var(--text);font-family:var(--font);
  }
  header{
    position:sticky;top:0;z-index:10;background:rgba(17,24,39,.85);
    backdrop-filter:blur(10px);border-bottom:1px solid var(--border);
  }
  .wrap{max-width:880px;margin:0 auto;padding:14px}
  .title{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .title h1{margin:0;font-size:20px}
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  input[type="search"]{
    flex:1;min-width:220px;background:#0b1220;border:1px solid var(--border);color:var(--text);
    padding:10px;border-radius:12px;outline:none;font-size:14px;
  }
  .btn{background:var(--brand);color:#081325;border:0;border-radius:12px;padding:10px 14px;cursor:pointer;font-weight:700}
  .btn.ghost{background:#0b1220;color:var(--muted);border:1px solid var(--border);font-weight:600}
  .btn.warn{background:#f59e0b;color:#0b0f1a}
  .cats{display:flex;gap:6px;flex-wrap:wrap;margin-top:8px}
  .cat{padding:6px 12px;background:#0b1220;border:1px solid var(--border);border-radius:999px;color:var(--muted);cursor:pointer;font-size:13px}
  .cat.active{background:var(--accent);color:#062027;border-color:transparent;font-weight:800}
  main{padding:10px 0}

  /* Ù„ÛŒØ³Øª Ø¹Ù…ÙˆØ¯ÛŒ */
  .list{background:transparent;border:1px solid var(--border);border-radius:14px;overflow:hidden}
  .item{
    display:flex;align-items:center;gap:12px;
    padding:10px 12px;background:var(--row);
    border-bottom:1px dashed var(--border);
  }
  .item:last-child{border-bottom:none}
  .item:hover{background:var(--panel)}
  .num{
    width:32px;height:32px;border-radius:50%;background:var(--brand);color:#061122;
    display:flex;align-items:center;justify-content:center;font-weight:900;flex:0 0 32px
  }
  .item.dragging{opacity:.5}
  .item.drop-before{box-shadow:0 -3px 0 0 var(--accent)}
  .item.drop-after{box-shadow:0 3px 0 0 var(--accent)}
  /* Ø¨Ø®Ø´ Ú©Ù„ÛŒÚ©â€ŒÙ¾Ø°ÛŒØ± Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²Ú©Ø±Ø¯Ù† Ù„ÛŒÙ†Ú© */
  .info{
    display:flex;flex-direction:column;gap:2px;min-width:0;cursor:pointer;
  }
  .name{font-weight:900;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-size:15px}
  .meta{color:var(--muted);font-size:12.5px}
  .actions{margin-right:auto;display:flex;align-items:center;gap:8px}
  .btn.small{padding:6px 10px;border-radius:9px;font-weight:800;font-size:13px}
  .btn.star{background:#0b1220;border:1px solid var(--border);color:var(--star)}
  .btn.edit{background:var(--edit);color:#081325}
  .btn.delete{background:var(--danger);color:#0b0f1a}
  .hint{opacity:.7;font-size:12px;padding:8px}
  footer{opacity:.7;font-size:12px;padding:10px 14px;border-top:1px solid var(--border)}

  dialog{
    border:1px solid #243244;border-radius:14px;background:#0d1426;color:var(--text);
    max-width:520px;width:calc(100% - 24px);padding:16px;
  }
  dialog form{display:grid;gap:10px}
  dialog input, dialog select{
    background:#0b1220;border:1px solid var(--border);color:var(--text);
    padding:10px;border-radius:10px;width:100%;font-size:14px
  }
  .form-row{display:grid;gap:10px;grid-template-columns:1fr 1fr}
  .small{font-size:12px;color:var(--muted)}

  /* Gate (simple password overlay) */
  #gate{position:fixed;inset:0;background:rgba(8,12,24,.96);display:none;align-items:center;justify-content:center;z-index:9999}
  #gate .panel{background:#0d1426;border:1px solid var(--border);border-radius:14px;padding:20px;width:min(380px,calc(100% - 24px));display:grid;gap:10px;color:var(--text)}
  #gate input{background:#0b1220;border:1px solid var(--border);color:var(--text);padding:10px;border-radius:10px;font-size:14px}
  #gate .err{color:#f87171;font-size:12px;min-height:16px}
  #gate .passwrap{position:relative;display:flex;align-items:center}
  #gate .passwrap input{width:100%;padding-inline-end:40px}
  #gate .passwrap .eye{position:absolute;right:8px;background:transparent;border:0;color:var(--muted);cursor:pointer;font-size:18px;line-height:1;padding:4px;border-radius:8px}
  #gate .passwrap .eye:hover{color:var(--text);background:#0b1220}
</style>
</head>
<body>
  <!-- Password Gate -->
  <div id="gate" aria-modal="true" role="dialog">
    <div class="panel">
      <h3 style="margin:0">ÙˆØ±ÙˆØ¯</h3>
      <div class="small">Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†</div>
      <div class="passwrap">
        <input id="gatePass" type="password" />
        <button type="button" id="gateToggle" class="eye" aria-label="Ù†Ù…Ø§ÛŒØ´ Ø±Ù…Ø²">ğŸ‘</button>
      </div>
      <div id="gateErr" class="err"></div>
      <button class="btn" id="gateBtn">ÙˆØ±ÙˆØ¯</button>
    </div>
  </div>
  <header>
    <div class="wrap">
      <div class="title">
        <h1>ğŸ“ƒ Ù„ÛŒØ³Øª Ú©Ø§Ù†Ø§Ù„â€ŒÙ‡Ø§</h1>
        <span class="small">Ø³Ø§Ø¯Ù‡ØŒ Ø±Ø§Ø³Øªâ€ŒÚ†ÛŒÙ†ØŒ Ù‚Ø§Ø¨Ù„â€ŒÙˆÛŒØ±Ø§ÛŒØ´ â€” ÙÙ‚Ø· Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ø±Ø³Ù…ÛŒ Ùˆ Ù‚Ø§Ù†ÙˆÙ†ÛŒ</span>
      </div>
      <div class="controls">
        <input id="q" type="search" placeholder="Ø¬Ø³ØªØ¬ÙˆÛŒ Ú©Ø§Ù†Ø§Ù„â€¦" />
        <button class="btn" id="addBtn">â• Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ù†Ø§Ù„</button>
        <button class="btn ghost" id="exportBtn">â¬‡ï¸ Ø®Ø±ÙˆØ¬ÛŒ JSON</button>
        <button class="btn ghost" id="importBtn">â¬†ï¸ ÙˆØ±ÙˆØ¯ JSON</button>
        <button class="btn warn" id="resetBtn" title="Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ø¨Ù‡ Ù¾ÛŒØ´â€ŒÙØ±Ø¶â€ŒÙ‡Ø§">Reset</button>
      </div>
      <div class="cats" id="cats"></div>
    </div>
  </header>

  <main class="wrap">
    <div id="list" class="list"></div>
    <div id="empty" class="hint" style="display:none">Ú†ÛŒØ²ÛŒ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯. Ø§Ø² Ø¬Ø³ØªØ¬Ùˆ/Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§ Ú©Ù…Ú© Ø¨Ú¯ÛŒØ± ÛŒØ§ Â«Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ù†Ø§Ù„Â» Ø±Ø§ Ø¨Ø²Ù†.</div>
  </main>

  <footer class="wrap">
    <div>Ù†Ú©ØªÙ‡: Ø¨Ø±Ø®ÛŒ Ù¾Ø®Ø´â€ŒÙ‡Ø§ Ù…Ù…Ú©Ù† Ø§Ø³Øª Ø¨Ù‡â€ŒØ¯Ù„ÛŒÙ„ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ù…Ù†Ø·Ù‚Ù‡â€ŒØ§ÛŒ Ø¨Ø§Ø² Ù†Ø´ÙˆÙ†Ø¯. ÙÙ‚Ø· URLÙ‡Ø§ÛŒ Ø±Ø³Ù…ÛŒ/Ù…Ø¬Ø§Ø² Ø±Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†.</div>
  </footer>

  <!-- Dialog: Add/Edit -->
  <dialog id="dlg">
    <form id="form">
      <h3>Ø§ÙØ²ÙˆØ¯Ù†/ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ø§Ù†Ø§Ù„</h3>
      <div class="form-row">
        <input name="name" placeholder="Ù†Ø§Ù… Ú©Ø§Ù†Ø§Ù„ (Ù…Ø«Ù„Ø§Ù‹ Manoto)" required />
        <select name="category" required>
          <option value="Ø®Ø¨Ø±">Ø®Ø¨Ø±</option>
          <option value="ÙÛŒÙ„Ù…â€ŒÙˆØ³Ø±ÛŒØ§Ù„">ÙÛŒÙ„Ù…â€ŒÙˆØ³Ø±ÛŒØ§Ù„</option>
          <option value="Ù…Ø³ØªÙ†Ø¯">Ù…Ø³ØªÙ†Ø¯</option>
          <option value="Ù…ÙˆØ³ÛŒÙ‚ÛŒ">Ù…ÙˆØ³ÛŒÙ‚ÛŒ</option>
          <option value="Ú©ÙˆØ¯Ú©">Ú©ÙˆØ¯Ú©</option>
          <option value="ÙˆØ±Ø²Ø´ÛŒ">ÙˆØ±Ø²Ø´ÛŒ</option>
          <option value="Ø¹Ù…ÙˆÙ…ÛŒ">Ø¹Ù…ÙˆÙ…ÛŒ</option>
        </select>
      </div>
      <input name="url" placeholder="Ù„ÛŒÙ†Ú© Ù¾Ø®Ø´ Ø±Ø³Ù…ÛŒ (https://â€¦)" required />
      <input name="logo" placeholder="Ù„ÛŒÙ†Ú© Ù„ÙˆÚ¯Ùˆ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)" />
      <div class="small">ØµØ±ÙØ§Ù‹ URL Ø±Ø³Ù…ÛŒ/Ù‚Ø§Ù†ÙˆÙ†ÛŒ Ø±Ø§ Ù‚Ø±Ø§Ø± Ø¨Ø¯Ù‡.</div>
      <div style="display:flex;gap:8px;justify-content:flex-end">
        <button type="submit" class="btn">Ø°Ø®ÛŒØ±Ù‡</button>
        <button type="button" class="btn ghost" id="closeDlg">Ø§Ù†ØµØ±Ø§Ù</button>
      </div>
    </form>
  </dialog>

<script>
/* ---------- Ù…Ø­Ø§ÙØ¸ Ø³Ø§Ø¯Ù‡ (Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø³Ù…Øª Ú©Ø§Ø±Ø¨Ø±) ---------- */
const PASS = "farzin@mn"; // Ø±Ù…Ø² Ø¯Ù„Ø®ÙˆØ§Ù‡
function tryAuth(){
  const input = document.getElementById('gatePass');
  const err   = document.getElementById('gateErr');
  if(!input) return;
  if(input.value === PASS){
    sessionStorage.setItem('auth','1');
    document.getElementById('gate').style.display='none';
    renderCats(); renderList();
  }else{
    err.textContent = 'Ø±Ù…Ø² Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª.';
    input.focus();
  }
}
function setupGate(){
  const gate = document.getElementById('gate');
  const input= document.getElementById('gatePass');
  const btn  = document.getElementById('gateBtn');
  const tgl  = document.getElementById('gateToggle');
  const authed = sessionStorage.getItem('auth')==='1';
  if(authed){ gate.style.display='none'; return renderCats(), renderList(); }
  gate.style.display='flex';
  btn.onclick = tryAuth;
  input.addEventListener('keydown', (e)=>{ if(e.key==='Enter') tryAuth(); });
  if(tgl) tgl.onclick = togglePass;
}

function togglePass(){
  const input = document.getElementById('gatePass');
  const tgl = document.getElementById('gateToggle');
  if(!input || !tgl) return;
  if(input.type === 'password'){
    input.type = 'text';
    tgl.textContent = 'ğŸ™ˆ';
    tgl.setAttribute('aria-label','Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ø±Ù…Ø²');
  } else {
    input.type = 'password';
    tgl.textContent = 'ğŸ‘';
    tgl.setAttribute('aria-label','Ù†Ù…Ø§ÛŒØ´ Ø±Ù…Ø²');
  }
  input.focus({ preventScroll: true });
}

/* ---------- Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ (ÙÙ‚Ø· Ø±Ø³Ù…ÛŒ/Ù‚Ø§Ù†ÙˆÙ†ÛŒ) ---------- */
const DEFAULT_CHANNELS = [
  {name:"Iran International", category:"Ø®Ø¨Ø±", url:"https://www.youtube.com/watch?v=otooINZRTSQ", logo:""},
  {name:"ÙÛŒÙ„Ù… Ù‡Ø§ÛŒ ÛŒÙˆØªÛŒÙˆØ¨", category:"ÙÛŒÙ„Ù…â€ŒÙˆØ³Ø±ÛŒØ§Ù„", url:"https://www.youtube.com/channel/UClgRkhTL3_hImCAmdLfDE4g", logo:""},
  {name:"Ù„ÛŒØ³Ø§Ù†Ø³Ù‡ Ù‡Ø§", category:"ÙÛŒÙ„Ù…â€ŒÙˆØ³Ø±ÛŒØ§Ù„", url:"https://telewebion.com/product/0xc20be8f", logo:""},
  {name:"Ù…Ù† Ùˆ ØªÙˆ", category:"ÙÛŒÙ„Ù…â€ŒÙˆØ³Ø±ÛŒØ§Ù„", url:"https://www.youtube.com/watch?v=e8UIOWQqej4", logo:""},
  {name:"IFilm", category:"ÙÛŒÙ„Ù…â€ŒÙˆØ³Ø±ÛŒØ§Ù„", url:"https://telewebion.com/live/ifilm", logo:""},
  {name:"Ù†ÙˆØ§", category:"Ù…ÙˆØ³ÛŒÙ‚ÛŒ", url:"https://telewebion.com/live/nava", logo:""},
  {name:"Ø´Ø¨Ú©Ù‡ Ù†Ù…Ø§ÛŒØ´", category:"ÙÛŒÙ„Ù…â€ŒÙˆØ³Ø±ÛŒØ§Ù„", url:"https://telewebion.com/live/namayesh", logo:""},
  {name:"Ù…Ø³ØªÙ†Ø¯", category:"Ù…Ø³ØªÙ†Ø¯", url:"https://telewebion.com/live/mostanad", logo:""},
  {name:"Ù†Ø³ÛŒÙ…", category:"ÙÛŒÙ„Ù…â€ŒÙˆØ³Ø±ÛŒØ§Ù„", url:"https://telewebion.com/live/nasim", logo:""},
  {name:"Ø´Ù…Ø¹Ø¯ÙˆÙ†ÛŒ", category:"ÙÛŒÙ„Ù…â€ŒÙˆØ³Ø±ÛŒØ§Ù„", url:"https://telewebion.com/product/0xc20c9b9", logo:""},
  {name:"Ø³Ø§Ø®ØªÙ…Ø§Ù† Ù¾Ø²Ø´Ú©Ø§Ù†", category:"ÙÛŒÙ„Ù…â€ŒÙˆØ³Ø±ÛŒØ§Ù„", url:"https://telewebion.com/program/0x1b29476", logo:""},
  {name:"Ù…Ú¯Ù‡ ØªÙ…Ø§Ù… Ø¹Ù…Ø± Ú†Ù†Ø¯ØªØ§ Ø¨Ù‡Ø§Ø±Ù‡", category:"ÙÛŒÙ„Ù…â€ŒÙˆØ³Ø±ÛŒØ§Ù„", url:"https://www.filimo.com/m/sdp93", logo:""},
  {name:"ÙÙˆÙ‚ Ù„ÛŒØ³Ø§Ù†Ø³Ù‡ Ù‡Ø§", category:"ÙÛŒÙ„Ù…â€ŒÙˆØ³Ø±ÛŒØ§Ù„", url:"https://telewebion.com/program/0x1b2a5df", logo:""},
  {name:"Ø§ÛŒ ÙÛŒÙ„Ù… Û²", category:"ÙÛŒÙ„Ù…â€ŒÙˆØ³Ø±ÛŒØ§Ù„", url:"https://fa2.ifilmtv.ir/Home/Live", logo:""},
  {name:"BBC", category:"Ø®Ø¨Ø±", url:"https://www.parsatv.com/name=BBC-Persian#persian", logo:""},
  {name:"PMC", category:"Ù…ÙˆØ³ÛŒÙ‚ÛŒ", url:"https://www.parsatv.com/name=PMC-Royale#persian", logo:""},
  {name:"4music", category:"Ù…ÙˆØ³ÛŒÙ‚ÛŒ", url:"https://www.parsatv.com/name=4Music#persian", logo:""},
];

const KEY = "channels.v1.list";
const FAV_KEY = "channels.fav.v1";

/* ---------- Ø°Ø®ÛŒØ±Ù‡/Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ---------- */
function loadChannels(){
  const raw = localStorage.getItem(KEY);
  return raw ? JSON.parse(raw) : DEFAULT_CHANNELS.slice();
}
function saveChannels(list){ localStorage.setItem(KEY, JSON.stringify(list)); }
function loadFavs(){ const raw = localStorage.getItem(FAV_KEY); return raw ? new Set(JSON.parse(raw)) : new Set(); }
function saveFavs(set){ localStorage.setItem(FAV_KEY, JSON.stringify([...set])); }

/* ---------- Ø­Ø§Ù„Øª Ø¨Ø±Ù†Ø§Ù…Ù‡ ---------- */
let channels = loadChannels();
let favorites = loadFavs();
let activeCat = "Ù‡Ù…Ù‡";
let draggedName = null;

/* ---------- Ø§Ù„Ù…Ù†Øªâ€ŒÙ‡Ø§ ---------- */
const catsEl   = document.getElementById("cats");
const listEl   = document.getElementById("list");
const emptyEl  = document.getElementById("empty");
const qEl      = document.getElementById("q");
const dlg      = document.getElementById("dlg");
const form     = document.getElementById("form");
const addBtn   = document.getElementById("addBtn");
const closeDlg = document.getElementById("closeDlg");
const exportBtn= document.getElementById("exportBtn");
const importBtn= document.getElementById("importBtn");
const resetBtn = document.getElementById("resetBtn");

/* ---------- Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§ ---------- */
function categories(){
  const cats = new Set(["Ù‡Ù…Ù‡","â­ï¸ Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ…Ù†Ø¯ÛŒâ€ŒÙ‡Ø§"]);
  channels.forEach(c=>cats.add(c.category||"Ø¹Ù…ÙˆÙ…ÛŒ"));
  return [...cats];
}
function renderCats(){
  catsEl.innerHTML = "";
  categories().forEach(cat=>{
    const b = document.createElement("button");
    b.className = "cat" + (activeCat===cat ? " active" : "");
    b.textContent = cat;
    b.onclick = ()=>{ activeCat=cat; renderList(); renderCats(); };
    catsEl.appendChild(b);
  });
}

/* ---------- ÙÛŒÙ„ØªØ± ---------- */
function isMatch(ch){
  const q = (qEl.value||"").trim().toLowerCase();
  const inCat = (activeCat==="Ù‡Ù…Ù‡")
      || (activeCat==="â­ï¸ Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ…Ù†Ø¯ÛŒâ€ŒÙ‡Ø§" && favorites.has(ch.name))
      || (ch.category===activeCat);
  const inText = !q || ch.name.toLowerCase().includes(q) || (ch.category||"").toLowerCase().includes(q);
  return inCat && inText;
}

/* ---------- Ø±Ù†Ø¯Ø± Ù„ÛŒØ³Øª ---------- */
function renderList(){
  listEl.innerHTML = "";
  const data = channels.filter(isMatch);

  if(!data.length){ listEl.style.display="none"; emptyEl.style.display="block"; return; }
  listEl.style.display="block"; emptyEl.style.display="none";

  data.forEach((ch, index)=>{
    const row   = document.createElement("div");
    row.className = "item";

    const num   = document.createElement("div");
    num.className = "num";
    num.textContent = index + 1;

    const info  = document.createElement("div");
    info.className = "info";
    const name  = document.createElement("div"); name.className="name"; name.textContent = ch.name;
    const meta  = document.createElement("div"); meta.className="meta"; meta.textContent = ch.category || "Ø¹Ù…ÙˆÙ…ÛŒ";
    info.appendChild(name); info.appendChild(meta);

    const actions = document.createElement("div");
    actions.className = "actions";

    const clearDropClasses = ()=>{
      listEl.querySelectorAll(".drop-before, .drop-after").forEach(el=>{
        el.classList.remove("drop-before","drop-after");
      });
    };

    row.draggable = true;
    row.addEventListener("dragstart", e=>{
      draggedName = ch.name;
      e.dataTransfer.effectAllowed = "move";
      e.dataTransfer.setData("text/plain", ch.name);
      row.classList.add("dragging");
    });
    row.addEventListener("dragend", ()=>{
      draggedName = null;
      row.classList.remove("dragging");
      clearDropClasses();
    });
    row.addEventListener("dragover", e=>{
      if(!draggedName || draggedName===ch.name) return;
      e.preventDefault();
      clearDropClasses();
      const rect = row.getBoundingClientRect();
      const after = e.clientY > rect.top + rect.height/2;
      row.classList.add(after ? "drop-after" : "drop-before");
      e.dataTransfer.dropEffect = "move";
    });
    row.addEventListener("dragleave", ()=>{
      row.classList.remove("drop-before","drop-after");
    });
    row.addEventListener("drop", e=>{
      e.preventDefault();
      clearDropClasses();
      const dragKey = draggedName || e.dataTransfer.getData("text/plain");
      if(!dragKey || dragKey===ch.name) return;
      const fromIndex = channels.findIndex(c=>c.name===dragKey);
      const baseIndex = channels.findIndex(c=>c.name===ch.name);
      if(fromIndex<0 || baseIndex<0) return;
      const rect = row.getBoundingClientRect();
      const after = e.clientY > rect.top + rect.height/2;
      let toIndex = baseIndex + (after ? 1 : 0);
      if(fromIndex < toIndex) toIndex -= 1;
      if(fromIndex === toIndex) return;
      const [moved] = channels.splice(fromIndex,1);
      channels.splice(toIndex,0,moved);
      saveChannels(channels);
      renderList();
    });

    // â˜… Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ…Ù†Ø¯ÛŒ
    const btnFav = document.createElement("button");
    btnFav.className = "btn small star";
    btnFav.textContent = favorites.has(ch.name) ? "â˜…" : "â˜†";
    btnFav.title = "Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ…Ù†Ø¯ÛŒâ€ŒÙ‡Ø§";
    btnFav.onclick = (e)=>{
      e.preventDefault(); e.stopPropagation();
      if(favorites.has(ch.name)) favorites.delete(ch.name); else favorites.add(ch.name);
      saveFavs(favorites); renderList();
    };

    // ÙˆÛŒØ±Ø§ÛŒØ´
    const btnEdit = document.createElement("button");
    btnEdit.className = "btn small edit";
    btnEdit.textContent = "ÙˆÛŒØ±Ø§ÛŒØ´";
    btnEdit.onclick = (e)=>{
      e.preventDefault(); e.stopPropagation();
      editChannel(ch);
    };

    // Ø­Ø°Ù
    const btnDelete = document.createElement("button");
    btnDelete.className = "btn small delete";
    btnDelete.textContent = "Ø­Ø°Ù";
    btnDelete.onclick = (e)=>{
      e.preventDefault(); e.stopPropagation();
      if(confirm(`Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ú©Ø§Ù†Ø§Ù„ Â«${ch.name}Â» Ù…Ø·Ù…Ø¦Ù†ÛŒØ¯ØŸ`)){
        channels = channels.filter(c => c.name !== ch.name);
        saveChannels(channels); renderList();
      }
    };

    actions.appendChild(btnFav);
    actions.appendChild(btnEdit);
    actions.appendChild(btnDelete);

    // ÙÙ‚Ø· Ø±ÙˆÛŒ info Ù„ÛŒÙ†Ú© Ø¨Ø§Ø² Ø´ÙˆØ¯ (Ù†Ù‡ Ú©Ù„ Ø±Ø¯ÛŒÙ)
    info.style.cursor = "pointer";
    info.onclick = (e)=>{
      e.stopPropagation();
      window.open(ch.url, "_blank", "noopener");
    };

    // Ø¯ÙˆØ¨Ø§Ø± Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ Ø±Ø¯ÛŒÙ = ÙˆÛŒØ±Ø§ÛŒØ´
    row.ondblclick = ()=>{
      editChannel(ch);
    };

    row.appendChild(num);
    row.appendChild(info);
    row.appendChild(actions);
    listEl.appendChild(row);
  });
}

/* ---------- Ø§ÙØ²ÙˆØ¯Ù†/ÙˆÛŒØ±Ø§ÛŒØ´ ---------- */
function openDialog(initial){
  dlg.showModal();
  form.reset();
  if(initial){
    form.name.value = initial.name || "";
    form.category.value = initial.category || "Ø¹Ù…ÙˆÙ…ÛŒ";
    form.url.value = initial.url || "";
    form.logo.value = initial.logo || "";
    dlg.dataset.edit = initial.name;
  }else{
    delete dlg.dataset.edit;
  }
}
function editChannel(ch){ openDialog(ch); }
function upsertChannel(data, oldName){
  const i = channels.findIndex(c=>c.name===oldName);
  if(i>=0) channels[i] = data; else channels.push(data);
  saveChannels(channels); renderCats(); renderList();
}

/* ---------- Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ ---------- */
qEl.addEventListener("input", renderList);
addBtn.onclick    = ()=>openDialog();
closeDlg.onclick  = ()=>dlg.close();

form.onsubmit = (e)=>{
  e.preventDefault();
  const data = {
    name: form.name.value.trim(),
    category: form.category.value,
    url: form.url.value.trim(),
    logo: form.logo.value.trim()
  };
  if(!/^https?:\/\//i.test(data.url)){
    alert("Ù„Ø·ÙØ§Ù‹ Ù„ÛŒÙ†Ú© Ù…Ø¹ØªØ¨Ø± Ø¨Ø§ http/https ÙˆØ§Ø±Ø¯ Ú©Ù†.");
    return;
  }
  upsertChannel(data, dlg.dataset.edit);
  dlg.close();
};

exportBtn.onclick = ()=>{
  const blob = new Blob(
    [JSON.stringify({channels, favorites:[...favorites]}, null, 2)],
    {type:"application/json"}
  );
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "channels-export.json";
  a.click();
};

importBtn.onclick = ()=>{
  const inp = document.createElement("input");
  inp.type="file"; inp.accept="application/json";
  inp.onchange = ()=>{
    const f = inp.files[0]; if(!f) return;
    const r = new FileReader();
    r.onload = ()=>{
      try{
        const obj = JSON.parse(r.result);
        if(Array.isArray(obj.channels)){ channels = obj.channels; saveChannels(channels); }
        if(Array.isArray(obj.favorites)){ favorites = new Set(obj.favorites); saveFavs(favorites); }
        renderCats(); renderList();
      }catch(err){ alert("ÙØ§ÛŒÙ„ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª."); }
    };
    r.readAsText(f);
  };
  inp.click();
};

resetBtn.onclick = ()=>{
  if(confirm("Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ø¨Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ÙˆÙ„ÛŒÙ‡ØŸ")){
    channels  = DEFAULT_CHANNELS.slice(); saveChannels(channels);
    favorites = new Set();               saveFavs(favorites);
    activeCat = "Ù‡Ù…Ù‡"; qEl.value="";
    renderCats(); renderList();
  }
};

/* ---------- Ø´Ø±ÙˆØ¹ ---------- */
// Ø§Ø¨ØªØ¯Ø§ Ú¯ÛŒØª Ø³Ø§Ø¯Ù‡ Ø±Ø§ ÙØ¹Ø§Ù„ Ú©Ù†
setupGate();
</script>
</body>
</html>
